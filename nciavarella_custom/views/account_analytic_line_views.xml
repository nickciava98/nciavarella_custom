<odoo>
    <record id="account_analytic_line_search_inherit" model="ir.ui.view">
        <field name="name">account.analytic.line.search.inherit</field>
        <field name="model">account.analytic.line</field>
        <field name="inherit_id" ref="hr_timesheet.hr_timesheet_line_search"/>
        
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>

            <xpath expr="//field[@name='date']" position="before">
                <field name="name"/>
            </xpath>

            <xpath expr="//field[@name='date']" position="after">
                <field name="mese_competenza"/>
                <field name="anno_competenza"/>
            </xpath>

            <xpath expr="//filter[@name='month']" position="after">
                <filter name="competenza" string="Competenza" date="competenza"/>
                <filter name="oggi" string="Oggi"
                        domain="[('date', '=', datetime.datetime.now().strftime('%Y-%m-%d'))]"/>
                <filter name="mese_competenza_corrente" string="Mese competenza corrente"
                        domain="[('mese_competenza', '=', datetime.datetime.now().strftime('%m')), ('anno_competenza', '=', datetime.datetime.now().strftime('%Y'))]"/>
            </xpath>
        </field>
    </record>
    
    <record id="account_analytic_line_tree_inherit" model="ir.ui.view">
        <field name="name">account.analytic.line.tree.inherit</field>
        <field name="model">account.analytic.line</field>
        <field name="inherit_id" ref="hr_timesheet.hr_timesheet_line_tree"/>

        <field name="arch" type="xml">
            <xpath expr="//tree" position="attributes">
                <attribute name="editable">top</attribute>
                <attribute name="default_order">date desc, time_start desc</attribute>
            </xpath>

            <xpath expr="//field[@name='date']" position="before">
                <field name="is_invoiced" optional="show"/>
                <field name="invoice_id" optional="hide" readonly="True" force_save="1"/>
                <field name="is_confirmed" optional="show"/>
                <field name="anno_competenza" optional="hide"/>
                <field name="mese_competenza" optional="hide"/>
            </xpath>

            <xpath expr="//field[@name='date']" position="after">
                <field name="time_start" required="True" widget="timesheet_uom"/>
                <field name="time_end" required="True" widget="timesheet_uom"/>
            </xpath>

            <xpath expr="//field[@name='project_id']" position="attributes">
                <attribute name="options">{'no_create': True}</attribute>
            </xpath>

            <xpath expr="//field[@name='task_id']" position="attributes">
                <attribute name="options">{'no_create': True}</attribute>
            </xpath>

            <xpath expr="//tree/field[@name='unit_amount']" position="before">
                <field name="currency_id" invisible="True"/>
                <field name="valore" sum="Valore" optional="show"/>
            </xpath>
        </field>
    </record>

    <record id="link_invoice_timesheet_action" model="ir.actions.server">
        <field name="name">Link Invoice</field>
        <field name="model_id" ref="model_account_analytic_line"/>
        <field name="binding_model_id" ref="model_account_analytic_line"/>
        <field name="type">ir.actions.server</field>
        <field name="state">code</field>
        <field name="code">action = records.link_invoice_timesheet_action()</field>
    </record>

    <record id="download_excel_action" model="ir.actions.server">
        <field name="name">Esporta Prospetto Excel</field>
        <field name="model_id" ref="model_account_analytic_line"/>
        <field name="binding_model_id" ref="model_account_analytic_line"/>
        <field name="type">ir.actions.server</field>
        <field name="state">code</field>
        <field name="code">action = records.esporta_prospetto_excel_action()</field>
    </record>
</odoo>